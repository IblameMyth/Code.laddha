<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EMI</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#f8fafc;
      --card:rgba(255, 255, 255, 0.9);
      --muted:#6b7280;
      --text:#0f172a;
      --primary:#2563eb;
      --accent:#0ea5a4;
      --radius:12px;
      --shadow:0 8px 26px rgba(15,23,42,0.06);
      --container:1100px;
      --bg-img:url('https://images.unsplash.com/photo-1542223616-1e7b2d2b02d9?auto=format&fit=crop&w=1500&q=80');
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
      --glass-border: 1px solid rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;padding:28px;font-family:Inter,'Segoe UI',Roboto;background-image:linear-gradient(rgba(255,255,255,0.86),rgba(255,255,255,0.86)),var(--bg-img);background-size:cover;background-position:center;color:var(--text)}
    main{
      max-width:var(--container);
      margin:0 auto;
      min-height:68vh;
      padding:28px;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--glass-shadow);
    }
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
    header{display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--accent),var(--primary));color:#fff;padding:16px 20px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:18px}
    header h1{margin:0;font-size:1.6rem;font-family:'Poppins',sans-serif;font-weight:600;letter-spacing:0.5px}
    input[type="number"]{padding:10px;border-radius:10px;border:1px solid #e6eef8;background:#fff;min-width:150px;margin:8px}
    button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;cursor:pointer}
    canvas{
      display:block;
      margin:18px auto;
      max-width:640px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
      border-radius: var(--radius);
      border: var(--glass-border);
      box-shadow: var(--glass-shadow);
      padding:16px;
      backdrop-filter: blur(5px);
    }
    #summary{
      margin-top:12px;
      font-weight:600;
      padding: 12px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
      border-radius: var(--radius);
      border: var(--glass-border);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    .table-container {
      margin-top: 30px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
      border-radius: var(--radius);
      padding: 20px;
      border: var(--glass-border);
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(5px);
    }
    footer{margin-top:36px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>ExpenseWise</h1>
  </header>

  <main>
    <h2>EMI Expenses</h2>
    <div style="margin-bottom: 20px;">
      <label for="expenseMonth">Select Month: </label>
      <input type="month" id="expenseMonth" style="padding: 10px; border-radius: 10px; border: 1px solid #e6eef8;" />
    </div>
    <input type="number" id="homeLoan" placeholder="Home Loan EMI (₹)" />
    <input type="number" id="carLoan" placeholder="Car Loan EMI (₹)" />
    <input type="number" id="educationLoan" placeholder="Education Loan EMI (₹)" />
    <input type="number" id="personalLoan" placeholder="Personal Loan EMI (₹)" />
    <br />
    <button onclick="showEmiChart()">Show Chart</button>
    <button onclick="clearAllData()" style="background: linear-gradient(90deg, #dc2626, #ef4444); margin-left: 10px;">Clear All Data</button>
    <div id="summary"></div>
    <canvas id="emiChart"></canvas>

    <div class="table-container" style="margin-top: 30px;">
      <h3>Day-wise EMI Expenses</h3>
      <table class="expense-table" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
          <tr>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Date</th>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Home Loan (₹)</th>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Car Loan (₹)</th>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Education Loan (₹)</th>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Personal Loan (₹)</th>
            <th style="padding: 12px; background: linear-gradient(90deg, var(--accent), var(--primary)); color: white;">Total (₹)</th>
          </tr>
        </thead>
        <tbody id="expenseTableBody">
        </tbody>
        <tfoot>
          <tr>
            <td style="padding: 12px; font-weight: bold;">Monthly Total</td>
            <td id="totalHome" style="padding: 12px;">₹0</td>
            <td id="totalCar" style="padding: 12px;">₹0</td>
            <td id="totalEdu" style="padding: 12px;">₹0</td>
            <td id="totalPersonal" style="padding: 12px;">₹0</td>
            <td id="grandTotal" style="padding: 12px; font-weight: bold;">₹0</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </main>

  <footer>
    Plan your EMIs wisely to secure your future.
  </footer>

  <script>
    // Set current month as default
    window.addEventListener('load', function() {
      const today = new Date();
      const month = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
      document.getElementById('expenseMonth').value = month;
      loadMonthlyData(month);
    });

    // Load data for selected month
    document.getElementById('expenseMonth').addEventListener('change', function() {
      loadMonthlyData(this.value);
    });

    function loadMonthlyData(monthKey) {
      const savedData = localStorage.getItem('emiExpenses_' + monthKey);
      if (savedData) {
        const data = JSON.parse(savedData);
        document.getElementById('homeLoan').value = data.home || '';
        document.getElementById('carLoan').value = data.car || '';
        document.getElementById('educationLoan').value = data.edu || '';
        document.getElementById('personalLoan').value = data.personal || '';
        showEmiChart(); // Show chart with saved data
      } else {
        // Clear form if no data exists for selected month
        document.getElementById('homeLoan').value = '';
        document.getElementById('carLoan').value = '';
        document.getElementById('educationLoan').value = '';
        document.getElementById('personalLoan').value = '';
        document.getElementById('summary').innerHTML = '';
        if (window.emiChartInstance) {
          window.emiChartInstance.destroy();
        }
      }
    }

    function updateTable() {
      const tableBody = document.getElementById('expenseTableBody');
      tableBody.innerHTML = '';
      
      let totalHome = 0, totalCar = 0, totalEdu = 0, totalPersonal = 0;
      
      // Get all EMI expenses from localStorage
      const expenses = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('emiExpenses_')) {
          const data = JSON.parse(localStorage.getItem(key));
          if (data.date) { // Only include entries with dates
            expenses.push(data);
          }
        }
      }
      
      // Sort by date, newest first
      expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // Create table rows
      expenses.forEach(expense => {
        const row = document.createElement('tr');
        const total = expense.home + expense.car + expense.edu + expense.personal;
        
        row.innerHTML = `
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8; cursor: pointer;" onclick="loadExpense('${expense.date}')">${expense.date}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.home}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.car}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.edu}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.personal}</td>
          <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${total}</td>
        `;
        
        tableBody.appendChild(row);
        
        totalHome += expense.home;
        totalCar += expense.car;
        totalEdu += expense.edu;
        totalPersonal += expense.personal;
      });
      
      // Update totals
      document.getElementById('totalHome').textContent = `₹${totalHome}`;
      document.getElementById('totalCar').textContent = `₹${totalCar}`;
      document.getElementById('totalEdu').textContent = `₹${totalEdu}`;
      document.getElementById('totalPersonal').textContent = `₹${totalPersonal}`;
      document.getElementById('grandTotal').textContent = `₹${totalHome + totalCar + totalEdu + totalPersonal}`;
    }

    function loadExpense(date) {
      document.getElementById('expenseMonth').value = date.substring(0, 7);
      const data = JSON.parse(localStorage.getItem(`emiExpenses_${date}`));
      if (data) {
        document.getElementById('homeLoan').value = data.home;
        document.getElementById('carLoan').value = data.car;
        document.getElementById('educationLoan').value = data.edu;
        document.getElementById('personalLoan').value = data.personal;
        showEmiChart();
      }
    }

    function showEmiChart() {
      const home = parseInt(document.getElementById('homeLoan').value) || 0;
      const car = parseInt(document.getElementById('carLoan').value) || 0;
      const edu = parseInt(document.getElementById('educationLoan').value) || 0;
      const personal = parseInt(document.getElementById('personalLoan').value) || 0;
      const total = home + car + edu + personal;

      // Get the full date (YYYY-MM-DD)
      const monthKey = document.getElementById('expenseMonth').value;
      const today = new Date();
      const date = `${monthKey}-${String(today.getDate()).padStart(2, '0')}`;
      
      // Save data to localStorage with date key
      localStorage.setItem('emiExpenses_' + date, JSON.stringify({ 
        date: date,
        home: home, 
        car: car, 
        edu: edu, 
        personal: personal 
      }));
      
      // Update the table
      updateTable();

      document.getElementById('summary').innerHTML = `<h3>Total EMI Expenses: ₹${total}</h3>`;

      const ctx = document.getElementById('emiChart').getContext('2d');
      if (window.emiChartInstance) {
        window.emiChartInstance.destroy();
      }

      window.emiChartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Home Loan', 'Car Loan', 'Education Loan', 'Personal Loan'],
          datasets: [{
            data: [home, car, edu, personal],
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#8E44AD']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.raw;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${context.label}: ${percentage}% (₹${value})`;
                }
              }
            },
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function clearAllData() {
      if (confirm('Are you sure you want to clear all EMI expense data? This cannot be undone.')) {
        // Get all keys from localStorage
        const keys = Object.keys(localStorage);
        
        // Remove only EMI-related data
        let deletedCount = 0;
        keys.forEach(key => {
          if (key.startsWith('emiExpenses_')) {
            localStorage.removeItem(key);
            deletedCount++;
          }
        });
        
        // Clear form fields
        document.getElementById('homeLoan').value = '';
        document.getElementById('carLoan').value = '';
        document.getElementById('educationLoan').value = '';
        document.getElementById('personalLoan').value = '';
        
        // Clear chart
        if (window.emiChartInstance) {
          window.emiChartInstance.destroy();
          window.emiChartInstance = null;
        }
        
        // Clear summary
        document.getElementById('summary').innerHTML = '';
        
        // Update table
        updateTable();
        
        alert(`Successfully cleared ${deletedCount} EMI expense records.`);
      }
    }

    // Initialize functions
    window.showEmiChart = showEmiChart;
    window.loadExpense = loadExpense;
    window.clearAllData = clearAllData;
  </script>
</body>
</html>
