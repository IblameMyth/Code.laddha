<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entertainment</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        :root{
            --bg:#f8fafc;
            --card:rgba(255, 255, 255, 0.9);
            --muted:#6b7280;
            --text:#0f172a;
            --primary:#2563eb;
            --accent:#0ea5a4;
            --radius:12px;
            --shadow:0 8px 26px rgba(15,23,42,0.06);
            --container:1100px;
            --bg-img:url('https://images.unsplash.com/photo-1542223616-1e7b2d2b02d9?auto=format&fit=crop&w=1500&q=80');
            --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        *{box-sizing:border-box}html,body{height:100%}
        body{margin:0;padding:28px;font-family:Inter,'Segoe UI',Roboto;background-image:linear-gradient(rgba(255,255,255,0.86),rgba(255,255,255,0.86)),var(--bg-img);background-size:cover;background-position:center;color:var(--text)}
        main{
            max-width:var(--container);
            margin:0 auto;
            min-height:68vh;
            padding:28px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: var(--glass-border);
            border-radius: var(--radius);
            box-shadow: var(--glass-shadow);
        }
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        header{display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--accent),var(--primary));color:#fff;padding:16px 20px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:18px}
        header h1{margin:0;font-size:1.6rem;font-family:'Poppins',sans-serif;font-weight:600;letter-spacing:0.5px}
        input{padding:10px;border-radius:10px;border:1px solid #e6eef8;background:#fff;min-width:150px;margin:8px}
        button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;cursor:pointer}
        canvas{
            display:block;
            margin:18px auto;
            max-width:640px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border-radius: var(--radius);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding:16px;
            backdrop-filter: blur(5px);
        }
        #summary{
            margin-top:12px;
            font-weight:600;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            border-radius: var(--radius);
            border: var(--glass-border);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        .table-container {
            margin-top: 30px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border-radius: var(--radius);
            padding: 20px;
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(5px);
        }
        footer{margin-top:36px;text-align:center;color:var(--muted)}
    </style>
</head>
<body>
    <header>
        <h1>ExpenseWise</h1>
    </header>
    <main>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <h1>Entertainment Expenses</h1>
        <div style="margin-bottom: 20px;">
            <label for="expenseMonth">Select Month: </label>
            <input type="month" id="expenseMonth" style="padding: 10px; border-radius: 10px; border: 1px solid #e6eef8;" />
        </div>
        <input type="number" id="movies" placeholder="Movies (₹)" />
        <input type="number" id="parties" placeholder="Parties (₹)" />
        <input type="number" id="gatherings" placeholder="Family Gatherings (₹)" />
        <button onclick="showChart()">Show Chart</button>
        <button onclick="clearAllData()" style="background: linear-gradient(90deg, #dc2626, #ef4444); margin-left: 10px;">Clear All Data</button>
        <div id="summary"></div>
        <canvas id="entChart"></canvas>

        <div class="table-container" style="margin-top: 20px;">
            <table class="expense-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e6eef8;">Date</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e6eef8;">Movies</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e6eef8;">Parties</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e6eef8;">Gatherings</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e6eef8;">Total</th>
                    </tr>
                </thead>
                <tbody id="expenseTableBody"></tbody>
                <tfoot>
                    <tr>
                        <td style="padding: 12px; font-weight: bold;">Total</td>
                        <td id="totalMovies" style="padding: 12px;">₹0</td>
                        <td id="totalParties" style="padding: 12px;">₹0</td>
                        <td id="totalGatherings" style="padding: 12px;">₹0</td>
                        <td id="grandTotal" style="padding: 12px; font-weight: bold;">₹0</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <script>
            // Set current month as default and initialize
            window.addEventListener('load', () => {
                const today = new Date();
                const month = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
                document.getElementById('expenseMonth').value = month;
                updateTable();
            });

            // Update data when month changes
            document.getElementById('expenseMonth').addEventListener('change', () => {
                updateTable();
            });

            function updateTable() {
                const tableBody = document.getElementById('expenseTableBody');
                if (!tableBody) return;
                tableBody.innerHTML = '';

                const expenses = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('entertainmentExpenses_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data && data.date && data.date.startsWith(document.getElementById('expenseMonth').value)) {
                                expenses.push(data);
                            }
                        } catch (e) { /* ignore malformed */ }
                    }
                }

                expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

                let totalMovies = 0, totalParties = 0, totalGatherings = 0;

                expenses.forEach(expense => {
                    const row = document.createElement('tr');
                    const total = (expense.movies || 0) + (expense.parties || 0) + (expense.gatherings || 0);
                    row.innerHTML = `
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef8; cursor: pointer;" onclick="loadExpense('${expense.date}')">
                            ${expense.date}
                        </td>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.movies || 0}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.parties || 0}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${expense.gatherings || 0}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef8;">₹${total}</td>
                    `;

                    tableBody.appendChild(row);

                    totalMovies += expense.movies || 0;
                    totalParties += expense.parties || 0;
                    totalGatherings += expense.gatherings || 0;
                });

                document.getElementById('totalMovies').textContent = `₹${totalMovies}`;
                document.getElementById('totalParties').textContent = `₹${totalParties}`;
                document.getElementById('totalGatherings').textContent = `₹${totalGatherings}`;
                document.getElementById('grandTotal').textContent = `₹${totalMovies + totalParties + totalGatherings}`;
            }

            function loadExpense(date) {
                document.getElementById('expenseMonth').value = date.substring(0, 7);
                const data = JSON.parse(localStorage.getItem(`entertainmentExpenses_${date}`));
                if (data) {
                    document.getElementById('movies').value = data.movies || '';
                    document.getElementById('parties').value = data.parties || '';
                    document.getElementById('gatherings').value = data.gatherings || '';
                    showChart();
                }
            }

            function showChart() {
                // Get current values
                const movies = parseInt(document.getElementById('movies').value) || 0;
                const parties = parseInt(document.getElementById('parties').value) || 0;
                const gatherings = parseInt(document.getElementById('gatherings').value) || 0;
                const total = movies + parties + gatherings;

                // Get full date for storage
                const monthKey = document.getElementById('expenseMonth').value;
                const today = new Date();
                const date = `${monthKey}-${String(today.getDate()).padStart(2, '0')}`;
                
                // Save data
                localStorage.setItem('entertainmentExpenses_' + date, JSON.stringify({ 
                    date: date,
                    movies: movies, 
                    parties: parties, 
                    gatherings: gatherings
                }));

                // Update UI
                updateTable();
                document.getElementById('summary').innerHTML = `<h3>Total Entertainment Expenses: ₹${total}</h3>`;

                // Clear existing chart if any
                if (window.entChartInstance) {
                    window.entChartInstance.destroy();
                }

                // Create new chart
                const ctx = document.getElementById('entChart').getContext('2d');
                window.entChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Movies', 'Parties', 'Family Gatherings'],
                        datasets: [{
                            data: [movies, parties, gatherings],
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                        }]
                    },
                    options: { 
                        responsive: true, 
                        plugins: { 
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: ${percentage}% (₹${value})`;
                                    }
                                }
                            },
                            legend: { position: 'bottom' } 
                        } 
                    }
                });
            }

            function clearAllData() {
                if (confirm('Are you sure you want to clear all entertainment expense data? This cannot be undone.')) {
                    // Get all keys from localStorage
                    const keys = Object.keys(localStorage);
                    
                    // Remove only entertainment-related data
                    let deletedCount = 0;
                    keys.forEach(key => {
                        if (key.startsWith('entertainmentExpenses_')) {
                            localStorage.removeItem(key);
                            deletedCount++;
                        }
                    });
                    
                    // Clear form fields
                    document.getElementById('movies').value = '';
                    document.getElementById('parties').value = '';
                    document.getElementById('gatherings').value = '';
                    
                    // Clear chart
                    if (window.entChartInstance) {
                        window.entChartInstance.destroy();
                        window.entChartInstance = null;
                    }
                    
                    // Clear summary
                    document.getElementById('summary').innerHTML = '';
                    
                    // Update table
                    updateTable();
                    
                    alert(`Successfully cleared ${deletedCount} entertainment expense records.`);
                }
            }

            // Initialize table and expose functions
            updateTable();
            window.showChart = showChart;
            window.loadExpense = loadExpense;
        </script>
    </main>

    <footer>
        Beware of little expenses. A small leak will sink a great ship.
    </footer>
</body>
</html>